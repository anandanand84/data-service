(function e$$0(k,l,p){function c(h,f){if(!l[h]){if(!k[h]){var d="function"==typeof require&&require;if(!f&&d)return d(h,!0);if(m)return m(h,!0);d=Error("Cannot find module '"+h+"'");throw d.code="MODULE_NOT_FOUND",d;}d=l[h]={exports:{}};k[h][0].call(d.exports,function(d){var f=k[h][1][d];return c(f?f:d)},d,d.exports,e$$0,k,l,p)}return l[h].exports}for(var m="function"==typeof require&&require,f=0;f<p.length;f++)c(p[f]);return c})({1:[function(n,k,l){(function(k){var c=n("protobufjs"),m=n("q"),f=n("ws"),
h=function(){function a(){this.topics={};this.subUid=-1;if(a._instance)throw Error("Error: Instantiation failed: Use PubSub.getInstance() instead of new.");}a.getInstance=function(){null===a._instance&&(a._instance=new a);return a._instance};a.prototype.publish=function(a,e){if(!this.topics[a])return!1;for(var b=this.topics[a],g=b?b.length:0;g--;)b[g].func(a,e);return!0};a.prototype.subscribe=function(a,e){this.topics[a]||(this.topics[a]=[]);var b=(++this.subUid).toString();this.topics[a].push({token:b,
func:e});return b};a.prototype.unsubscribe=function(a){for(var e in this.topics)if(this.topics[e]){for(var b=0,g=this.topics[e].length;b<g;b++)if(this.topics[e][b].token===a)return this.topics[e].splice(b,1),!0;0==this.topics[e].length&&delete this.topics[e]}return!1};a._instance=null;return a}(),q=!1;if("undefined"!==typeof l&&this.exports!==l)q=!0;else{var d=d||{};if("undefined"===typeof d||!d.ProtoBuf)throw Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");
}var c=c.loadProtoFile("StockMessages.proto"),v=c.build("Header"),r=c.build("HeaderReader");c.build("BarDetails");c.build("ChartResponseData");c.build("ChartRequestData");var x=c.build("ChartRequest"),y=c.build("ChartResponse"),z=c.build("AvailableScripsResponse"),A=c.build("AvailableScripsRequest");c.build("AvailableScripsResponseData");c.build("AvailableScripsRequestData");var t=c.build("QuoteSubscriptionRequest");c.build("QuoteSubscriptionRequestData");var B=c.build("QuoteSubscriptionResponse");
c.build("QuoteSubscriptionResponseData");for(var C=function(){function a(a){this.requestMap={};this.eventsMap={};this.wsUri1="ws://traderslab.in:8484/iciciAutomation/websocket";this.websocket1=new f(this.wsUri1);this.lastConnectTimeout=5E3;this.pendingRequestArray=[];this.flushRequests=function(){if(this.websocket1.readyState==f.OPEN){var a;try{for(;0!=this.pendingRequestArray.length;)a=this.pendingRequestArray.shift(),this.sendMessage(a)}catch(b){this.pendingRequestArray.push(a),this.lastConnectTimeout*=
2,console.log("Connection lost retrying..."+this.lastConnectTimeout),setTimeout(this.flushRequests.bind(this),this.lastConnectTimeout)}}else this.websocket1.readyState==f.CONNECTING?(console.log("Waiting for connection to be established..."),setTimeout(this.flushRequests.bind(this),2E3)):this.websocket1.readyState==f.CLOSED&&(this.websocket1.close(),this.websocket1=new f(this.wsUri1),this.configureSocket(),this.lastConnectTimeout*=2,console.log("Retrying connection in "+this.lastConnectTimeout),setTimeout(this.flushRequests.bind(this),
this.lastConnectTimeout))};this.sendMessage=function(a){console.log((new Date).getTime()+" Message sent : "+a);q?this.websocket1.send(new k(new Uint8Array(a)),{binary:!0,mask:!0}):this.websocket1.send(a)};this.configureSocket=function(){var a=this;this.websocket1.binaryType="arraybuffer";this.websocket1.onmessage=function(b){try{var g=r.decode(b.data).header.callBackId;g&&(a.eventsMap[g]?a.eventsMap[g].notify(b.data):(a.requestMap[g].resolve(b.data),delete a.requestMap[g]))}catch(w){console.log(w)}};
this.websocket1.onopen=function(b){a.lastConnectTimeout=5E3;a.flushRequests()};this.websocket1.onclose=function(a){console.log("Websocket connection closed",a)};this.websocket1.onerror=function(a){console.log("Error occured on websocket connection",a)}};this.configureSocket()}a.prototype.processRequest=function(a,e){var b=m.defer();this.requestMap[a.header.callBackId]=b;e?this.sendMessage(a.toArrayBuffer()):(this.pendingRequestArray.push(a.toArrayBuffer()),this.flushRequests());return b.promise};
a.prototype.subscribeEvents=function(a,e){var b,g=a.header.callBackId;this.eventsMap[g]?b=this.eventsMap[g]:(b=m.defer(),this.eventsMap[g]=b);e?this.sendMessage(a.toArrayBuffer()):(this.pendingRequestArray.push(a.toArrayBuffer()),this.flushRequests());return b.promise};a.prototype.unSubscribeEvents=function(){};a.prototype.close=function(a){this.websocket1.close(1E3,a||"Client Closed the Browser")};return a}(),c=function(){function a(){var c=this;this.subscriptionProgressCreated=!1;this.SOCKET_CALLBACK_ID=
1;if(a._instance)throw Error("Error: Instantiation failed: Use DataService.getInstance() instead of new.");this.socket=new C;a._instance=this;q||window.addEventListener("beforeunload",function(){console.log("Before unload closing the socket");c.socket.close()})}a.getInstance=function(){null===a._instance&&(a._instance=new a);return a._instance};a.prototype.getNewCallbackId=function(){return"D"+(this.SOCKET_CALLBACK_ID++).toString()};a.prototype.addHeader=function(a,e){var b=new v;b.messageType=a;
b.handler=e;b.callBackId=this.getNewCallbackId();return b};a.prototype.getChartData=function(a){var e=m.defer(),b=new x;b.header=this.addHeader("ChartRequest","/chart/data");b.chReqData=a;this.socket.processRequest(b,!1).then(function(a){r.decode(a);a=y.decode(a);a=JSON.parse(JSON.stringify(a)).chResData;e.resolve(a)});return e.promise};a.prototype.getAvailableScrips=function(a){var e=m.defer(),b=new A;b.header=this.addHeader("AvailableScripsRequest","/availableScrips");b.reqData=a;this.socket.processRequest(b,
!1).then(function(a){a=z.decode(a);e.resolve(a.resData)});return e.promise};a.prototype.subscribeForScrips=function(a,e){var b=a.exchange+"_"+a.scrip,b=h.getInstance().subscribe(b,e),c=new t,d=this.addHeader("QuoteSubscriptionRequest","/marketWatch/subscribe");d.callBackId="quoteSubscription";c.header=d;c.reqData=a;c=this.socket.subscribeEvents(c,!1);this.subscriptionProgressCreated||c.progress(function(a){a=B.decode(a).resData.toRaw();var b=a.exchange+"_"+a.scrip;h.getInstance().publish(b,a)});return b};
a.prototype.unSubscribeForScrips=function(a,c){var b=h.getInstance().unsubscribe(c),d=new t,f=this.addHeader("QuoteSubscriptionRequest","/marketWatch/subscribe");f.callBackId="quoteSubscription";d.header=f;d.reqData=a;this.socket.subscribeEvents(d,!1);return b};a._instance=null;return a}(),d=[],u=0;1>u;u++)d.push(new c);d.forEach(function(a){a.id=setInterval(function(){var c=new Date;a.getChartData({interval:86400,requiredBars:500,scrip:"RELIANCE",registrationId:""}).then(function(a){console.log("Total Time take is "+
((new Date).getTime()-c.getTime())/1E3)},function(a){console.error(a)})},500)})}).call(this,n("buffer").Buffer)},{buffer:void 0,protobufjs:void 0,q:void 0,ws:void 0}]},{},[1]);
